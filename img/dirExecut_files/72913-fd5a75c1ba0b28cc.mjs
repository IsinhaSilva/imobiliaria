(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[72913],{335972:(t,n,e)=>{e.d(n,{Z:()=>Y});var a=e(667294),i=e(317672),r=e(790348);const o=t=>{const n=performance.getEntriesByType("resource").filter((t=>t.name.includes("i.pinimg"))).reduce(((t,n)=>{const e=n.name.replace(".jpg","").split("/");return{[e[e.length-1]]:{downloadSize:n.name.split("/")[3].split("x")[0]},...t}}),{});[...Array.from(document.getElementsByTagName("img")).map((t=>{const e=t.src.replace(".jpg","").split("/"),a=e[e.length-1];if(n[a]){var r;const e=(null===(r=(0,i.rZ)(t))||void 0===r?void 0:r.width)||1,o=n[a].downloadSize;return{fileName:a,renderedSize:e,downloadedSize:o,ratio:o/e}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}})),...Array.from(document.querySelectorAll('div[role="img"]')).map((t=>{const e=t.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),a=e[e.length-1];if(n[a]&&t instanceof HTMLDivElement){var r;const e=(null===(r=(0,i.rZ)(t))||void 0===r?void 0:r.width)||1,o=n[a].downloadSize;return{fileName:a,renderedSize:e,downloadedSize:o,ratio:o/e}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}}))].forEach((n=>{const{ratio:e,fileName:a,downloadedSize:i}=n;n.ratio>1.05&&(0,r.A9)(`checkImageRatio.${t}`,{count:Math.round(10*e)/10,tags:{fileName:`${i}_${a}`}})}))};var s=e(435851),c=e(860273),d=e(543059),l=e(607150);const m=({constraintMap:t,initialNavTiming:n,annotations:e})=>({...e,...(0,l.jh)("constraint_",t),...(0,l.jh)("mark_",(0,d.gQ)()),...(0,l.jh)("browser_",{...n?(0,l.D3)(n):{},...(0,l.rX)()})});var p=e(358864),u=e(505771),g=e(156381);const f=(t,n)=>{const{firstInputDelay:e}=(0,g.v2)();return[...t.map((t=>(0,u.Z)(t,n))).filter(Boolean),...e?[{name:"fid",id:(0,p.Z)(),parentId:n,startTime:e.startTime,endTime:e.endTime,annotationMap:{},binaryAnnotationMap:{}}]:[]]};var y=e(172071),T=e(22773),h=e(453821),_=e(638089);const S=({annotateExperiments:t,annotations:n,binaryAnnotations:e,constraintMap:a,endTime:i,imageTimings:r,metricId:o,pwtStaticContext:d,startTime:l,traceId:p,spans:u})=>{const S=(0,T.Cg)();let A;if("initial_app_load"===o.navigationType&&(A=(0,c.Z)()),"board"===o.surface&&!1===d.isAuthenticated){const t=(0,s.Z)(d),n=(0,g.Bn)();let e;e=n<=2500?"Good":n>2500&&n<=4e3?"Needs Improvement":"Poor";const a=Array.from(S.filter((t=>"number"==typeof t.encodedBodySize&&t.encodedBodySize>=1e4))),i=a.length;if(i>0&&"object"==typeof a[0]&&!Array.isArray(a[0])){const n={},r=a.sort(((t,n)=>t.fetchStart-n.fetchStart));n.zeroPercentInFlight=r[0].fetchStart,n.twentyFivePercentInFlight=r[Math.floor(i/4)].fetchStart,n.fiftyPercentInFlight=r[2*Math.floor(i/4)].fetchStart,n.seventyFivePercentInFlight=r[3*Math.floor(i/4)].fetchStart,n.hundredPercentInFlight=r[i-1].fetchStart;const o=a.sort(((t,n)=>t.responseEnd-n.responseEnd));n.twentyFivePercentComplete=o[Math.floor(i/4)].responseEnd,n.fiftyPercentComplete=o[2*Math.floor(i/4)].responseEnd,n.seventyFivePercentComplete=o[3*Math.floor(i/4)].responseEnd,n.hundredPercentComplete=o[i-1].responseEnd;for(const a in n)n[a]&&y.Z.timing(`${t}.board.${a}`,n[a],.1,{lcpTimingBucket:e})}}const I=r.map((({name:t})=>t)),v=S.map((t=>(0,h.p)(t,I))).filter((({timing:t})=>!(({startTime:t,responseEnd:n},e)=>t>e.endTime||!!n&&n<e.startTime||t<e.startTime-100)(t,{startTime:l,endTime:i})));return{type:"COMPLETE",traceId:p,startTime:l,endTime:i,spans:f(v,p).concat(u),annotationMap:m({constraintMap:a,initialNavTiming:A,annotations:n}),binaryAnnotationMap:(0,_.rA)({annotateExperiments:t,binaryAnnotations:e,entries:S,metricId:o,performanceResources:v,pwtEndTime:i,pwtStaticContext:d})}};let A=!1;const I=(t,n)=>t&&n?A?((0,r.H)("duplicated_initial_app_load_surface_pwt"),(0,p.Z)()):(A=!0,n):(0,p.Z)();var v=e(883119),x=e(226464),E=e(785893);function C({children:t,heading:n}){return(0,E.jsxs)("table",{style:{width:"100%"},cellPadding:4,children:[(0,E.jsx)("thead",{children:(0,E.jsx)("tr",{children:(0,E.jsx)("th",{colSpan:2,style:{background:"#efefef"},children:(0,E.jsx)(v.xv,{weight:"bold",align:"center",children:n})})})}),(0,E.jsx)("tbody",{children:t})]})}function M({name:t,children:n}){return(0,E.jsxs)("tr",{children:[(0,E.jsx)("td",{children:(0,E.jsx)(v.xv,{weight:"bold",children:t})}),(0,E.jsx)("td",{children:"string"==typeof n?(0,E.jsx)(v.xv,{children:n}):n})]})}function w({result:t}){return"ABORT"===t.type?(0,E.jsx)(M,{name:"Abort Reason",children:t.reason}):(0,E.jsxs)(a.Fragment,{children:[(0,E.jsx)(M,{name:"PWT (ms)",children:(0,E.jsx)(v.xv,{align:"end",children:Math.round(t.endTime-t.startTime)})}),(0,E.jsx)(M,{name:"PinTrace",children:(0,E.jsx)(v.xv,{italic:!0,children:(0,E.jsx)(v.rU,{href:`https://pintrace.pinadmin.com/zipkin/traces/${t.traceId.toString(16)}`,target:"blank",inline:!0,onClick:({dangerouslyDisableOnNavigation:t})=>t(),underline:"hover",children:"Open in a new tab"})})})]})}function N({data:t}){const{metricId:n,constraints:e,constraintMap:a,startTime:i,result:r}=t;return(0,E.jsxs)(v.xu,{children:[(0,E.jsxs)(C,{heading:(0,x.KJ)(n),children:[(0,E.jsx)(M,{name:"Thrift Id",children:String((0,x.Rp)(n))}),(0,E.jsx)(M,{name:"Surface",children:n.surface}),(0,E.jsx)(M,{name:"Navigation Type",children:n.navigationType}),(0,E.jsx)(M,{name:"Viewer Authed",children:String(n.isAuthenticated)})]}),(0,E.jsx)(C,{heading:"Constraints",children:e.map((t=>(0,E.jsx)(M,{name:t,children:(0,E.jsx)(v.xv,{align:"end",children:a[t]?Math.round(a[t]-i):"pending..."})},`constraint_${t}`)))}),(0,E.jsx)(C,{heading:"Result",children:r?(0,E.jsx)(w,{result:r}):(0,E.jsx)(M,{name:"result",children:(0,E.jsx)(v.$j,{accessibilityLabel:"profiling PWT",show:!0})})})]})}var b=e(223815);const j=t=>t.result?"COMPLETE"===t.result.type?"darkGray":"red":"gray";function O({data:t}){const[n,e]=(0,a.useState)(!1);return(0,E.jsx)(b.Z,{children:(0,E.jsxs)(v.mh,{children:[(0,E.jsx)(v.xu,{position:"fixed",margin:3,marginBottom:12,bottom:!0,left:!0,width:50,height:50,dangerouslySetInlineStyle:{__style:{zIndex:2e3}},children:(0,E.jsx)(v.hU,{accessibilityLabel:"PwtDebugger",bgColor:"lightGray",iconColor:j(t),icon:"flash",size:"lg",onClick:()=>e(!0)})}),n&&(0,E.jsx)(v.xu,{position:"absolute",dangerouslySetInlineStyle:{__style:{zIndex:2e3}},children:(0,E.jsx)(v.u_,{accessibilityModalLabel:"Pinner Wait Time Debugger Details",heading:"Pinner Wait Time",onDismiss:()=>e(!1),footer:null,size:"sm",children:(0,E.jsx)(v.xu,{padding:6,children:(0,E.jsx)(N,{data:t})})})})]})})}var P=e(558775);const R=(t,n)=>{const e=(0,a.useRef)(t);(0,a.useEffect)((()=>{e.current=t}),[t]);const i=(0,a.useRef)(n);(0,a.useEffect)((()=>{i.current=n}),[n]),(0,a.useEffect)((()=>()=>i.current(e.current)),[])},L=(t,n)=>{const[e,i]=(0,a.useState)(n);return{state:e,dispatch:n=>i((e=>t(e,n)))}};var B=e(985271),D=e(7789),Z=e(383434),z=e(567450),$=e(276602),U=e(198462);const G=["initial_app_load","client_route_push"],k=(0,Z.X)("PwtSurface"),H="NavigationComplete",K="VisuallyComplete",F=(t,n)=>{t.isSampled&&(0,P.Z)({metricId:t.metricConfig.metricId,pwtStaticContext:t.metricConfig.pwtStaticContext,result:{type:"ABORT",reason:n}})},V=t=>{if(t.metricConfig.constraints.every((n=>t.constraintMap[n]))){const n=Math.max(...t.metricConfig.constraints.map((n=>t.constraintMap[n])));return((t,n)=>{var e;const{metricConfig:{metricId:a,pwtStaticContext:i,annotateExperiments:s},annotations:c,binaryAnnotations:l,constraintMap:m,startTime:p,imageTimings:u,isSampled:g,spans:f}=t;(0,d.L8)(`PWT_Complete_${(0,x.KJ)(a)}`);const y=I("initial_app_load"===a.navigationType,null===(e=i.serverData)||void 0===e?void 0:e.trace_id),T=S({annotateExperiments:s,annotations:c,binaryAnnotations:l,constraintMap:m,endTime:n,imageTimings:u,metricId:a,pwtStaticContext:i,startTime:p,traceId:y,spans:f});g&&(0,P.Z)({metricId:a,pwtStaticContext:i,result:T});try{o(String(T.binaryAnnotationMap["metricId.surface"].value))}catch(h){(0,r.H)("image_ratio_check_error",{error:h})}return{...t,result:T,status:"DONE"}})(t,n)}return t},J=(t,n)=>{const{constraint:e,time:a}=n,i=(0,x.KJ)(t.metricConfig.metricId);return B.Z?t.metricConfig.constraints.find((t=>t===e))?t.constraintMap[e]?(k(`constraint "${e}" is already complete.`),(0,r.H)("duplicated_constraint_complete",{constraint:e,action:i}),t):(k(`marking constraint "${e}" as complete`),(0,d.ZP)(`constraint_${e}_is_complete`),V({...t,constraintMap:{...t.constraintMap,[e]:a||B.Z.now()}})):(k(`marked constraint "${e}" is not a required constraint.`),t):((0,r.H)("missing_window_performance",{action:i}),t)},W=(t,n)=>{if(k("dispatch action",n),"INIT_ROUTE"===n.type)return((t,n)=>{const{metricConfig:e,startTime:a,isSampled:i}=n;if("TIMING"===t.status&&a!==t.startTime&&F(t,"routeUpdatedOnSameSurface"),!e)return{status:"DISABLED",metricConfig:null};const o=(0,x.KJ)(e.metricId);return"TIMING"===t.status&&t.startTime===a&&t.constraintMap.NavigationComplete?((0,r.H)("duplicated_init_route_action",{action:o}),t):("Other"===e.pwtStaticContext.browserName&&!1===e.metricId.isAuthenticated&&"initial_app_load"===e.metricId.navigationType?((0,r.A9)(`TIMING.${o}`,{tags:{userAgent:null===(s=window)||void 0===s||null===(c=s.navigator)||void 0===c?void 0:c.userAgent}}),(0,r.A9)(`TIMING.sampled.${o}`,{tags:{userAgent:null===(d=window)||void 0===d||null===(l=d.navigator)||void 0===l?void 0:l.userAgent},sampleRate:.5})):((0,r.A9)(`TIMING.${o}`),(0,r.A9)(`TIMING.sampled.${o}`,{sampleRate:.5})),J({status:"TIMING",metricConfig:e,startTime:a,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:i,spans:[]},{constraint:H}));var s,c,d,l})(t,n.payload);if("TIMING"!==t.status)return k(`ignoring action due to invalid state ${t.status}`,n),t;switch(n.type){case"ABORT":F(t,n.reason);const e={type:"ABORT",reason:n.reason};return{...t,status:"DONE",result:e};case"ANNOTATE":const{name:a}=n.payload;if(!B.Z)return t;const i=B.Z.now();return k(`adding annotation {${a}: ${i}}`),{...t,annotations:{...t.annotations,[a]:i}};case"BINARY_ANNOTATE":const{name:o,value:s,annotationType:c}=n.payload;return k(`adding binary annotation {${o}: ${s}}`),{...t,binaryAnnotations:{...t.binaryAnnotations,[o]:{value:s,type:c}}};case"MARK_CONSTRAINT_COMPLETE":return J(t,n.payload);case"REMOVE_CONSTRAINT":return((t,n)=>{if(!B.Z){const n=(0,x.KJ)(t.metricConfig.metricId);(0,r.H)("missing_window_performance",{action:n})}k(`removing constraint "${n}"`);const e=t.metricConfig.constraints.filter((t=>t!==n)),{[n]:a,...i}=t.constraintMap;return V({...t,constraintMap:i,metricConfig:{...t.metricConfig,constraints:e}})})(t,n.payload);case"SET_SEGMENT":return((t,n)=>{if(!B.Z){const n=(0,x.KJ)(t.metricConfig.metricId);(0,r.H)("missing_window_performance",{action:n})}k(`updating pwt segment to "${n}"`);const e={...t.metricConfig.metricId,segment:n};return{...t,metricConfig:{...t.metricConfig,metricId:e}}})(t,n.payload);case"SET_VISUALLY_COMPLETE_RESULT":{const{payload:{imageTimings:e}}=n;if(0===e.length){F(t,"visuallyComplete_noImages");const n={type:"ABORT",reason:"visuallyComplete_noImages"};return{...t,status:"DONE",result:n}}const a=Math.max(...e.map((t=>t.responseEnd||0)));return J({...t,imageTimings:e},{constraint:K,time:a})}case"ADD_SUBSPAN":const{startTime:d}=t,{payload:{name:l,startTime:m,endTime:u,annotations:g,binaryAnnotations:f,parentId:y}}=n;return{...t,spans:[...t.spans,{name:l,id:(0,p.Z)(),startTime:m||d,endTime:u,annotationMap:{...g},binaryAnnotationMap:{...f},parentId:y}]};case"START_SUBSPAN":return{...t,spans:[...t.spans,{name:n.payload.name,id:(0,p.Z)(),startTime:B.Z?B.Z.now():0,endTime:1/0,annotationMap:{...n.payload.annotations},binaryAnnotationMap:{...n.payload.binaryAnnotations},parentId:n.payload.parentId}]};case"STOP_SUBSPAN":const T=t.spans.findIndex((t=>t.name===n.payload.name));return T>-1?(t.spans[T].endTime=B.Z?B.Z.now():0,n.payload.annotations&&(t.spans[T].annotationMap={...t.spans[T].annotationMap,...n.payload.annotations}),n.payload.binaryAnnotations&&(t.spans[T].binaryAnnotationMap={...t.spans[T].binaryAnnotationMap,...n.payload.binaryAnnotations})):(0,r.H)("invalid_subspan_stop_name",{name:n.payload.name}),t;default:const h=(0,x.KJ)(t.metricConfig.metricId);return(0,r.H)("invalid_pwt_surface_action",{action:h}),t}};function Y({children:t,...n}){var e;const i=(0,U.fM)(),o=(t=>{if(!t)return"initial_app_load";switch(t.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}})(i),s=["seo_web_react18_render","web_react18_render_auth","web_react18_render_unauth",...null!==(e=n.annotateExperiments)&&void 0!==e?e:[]],c={...n,annotateExperiments:s,navigationInfo:{navigationType:o,clientNavigation:i}},{state:d,context:l}=(({surface:t,constraints:n,segment:e,measureGridVisuallyComplete:i,annotateExperiments:r,customEnabledNavigationTypes:o,navigationInfo:{clientNavigation:s,navigationType:c},sampleRate:d})=>{const l=(0,a.useRef)("NOT_SET"),m=(0,U.N5)(),{state:p,dispatch:u}=L(W,{status:"DISABLED",metricConfig:null});if(l.current!==s&&(l.current=s,m)){const{isAuthenticated:a}=m,l=o||G,p=t&&c&&l.includes(c)?{metricId:{type:"surface",surface:t,navigationType:c,isAuthenticated:a,segment:e},annotateExperiments:r,constraints:[H,...n||[],...i?[K]:[]],pwtStaticContext:m}:null;u({type:"INIT_ROUTE",payload:{metricConfig:p,startTime:s?s.time:0,isSampled:!d||Math.random()<d}})}if((0,a.useEffect)((()=>{const t=t=>{u({type:"ABORT",reason:t})};z.Z.onSessionPause(t);const n=()=>{window.removeEventListener("resize",n),u({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",n),()=>{z.Z.removePauseListener(t),window.removeEventListener("resize",n)}}),[]),R(p,(t=>{k("handling unmount",t),"TIMING"===t.status&&F(t,"unmount")})),"TIMING"!==p.status||!p.constraintMap.NavigationComplete)return{state:p,context:null};const{startTime:g,metricConfig:f}=p;return{state:p,context:{id:g,metricId:f.metricId,abort:t=>u({type:"ABORT",reason:t}),addAnnotation:t=>u({type:"ANNOTATE",payload:{name:t}}),addBinaryAnnotation:(t,n,e)=>u({type:"BINARY_ANNOTATE",payload:{name:t,value:n,annotationType:e}}),setVisuallyCompleteResult:f.constraints.includes(K)?t=>u({type:"SET_VISUALLY_COMPLETE_RESULT",payload:t}):null,markConstraintComplete:t=>u({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:t,time:B.Z?B.Z.now():0}}),removeConstraint:t=>u({type:"REMOVE_CONSTRAINT",payload:t}),setSegment:t=>u({type:"SET_SEGMENT",payload:t}),addSubspan:(t,n,e,a={},i={},r=null)=>u({type:"ADD_SUBSPAN",payload:{name:t,startTime:n,endTime:e,annotations:a,binaryAnnotations:i,parentId:r}}),startSubspan:(t,n={},e={},a=null)=>u({type:"START_SUBSPAN",payload:{name:t,annotations:n,binaryAnnotations:e,parentId:a}}),stopSubspan:(t,n={},e={},a=null)=>u({type:"STOP_SUBSPAN",payload:{name:t,annotations:n,binaryAnnotations:e,parentId:a}})}}})(c);return(()=>{const t=(0,$.EV)(),n=!!t;(0,a.useEffect)((()=>{if(n){const n=null!=t&&t.metricId?(0,x.KJ)(t.metricId):null;(0,r.H)("nested_pwt_surface",{action:n})}}),[n])})(),(0,E.jsxs)(a.Fragment,{children:[(0,E.jsx)($.Sb,{value:l,children:t}),D.DQ&&"DISABLED"!==d.status&&(0,E.jsx)(O,{data:{metricId:d.metricConfig.metricId,constraints:d.metricConfig.constraints,constraintMap:d.constraintMap,startTime:d.startTime,result:"DONE"===d.status?d.result:null}})]})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/72913-fd5a75c1ba0b28cc.mjs.map